<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - IASEP Farmacia</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <!-- Estilos específicos para el login -->
    <style>
        .login-header {
            width: 100%;
            padding: 12px 24px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            background-color: var(--color-header-bg);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid var(--color-border);
            box-sizing: border-box;
        }

        .login-wrapper {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px 20px;
        }
    </style>
    <!-- Agregar la biblioteca de Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div class="login-header">
        <!-- Botón para cambiar de tema -->
        <button class="theme-toggle" id="themeToggle" title="Cambiar tema">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="moon-icon">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sun-icon"
                style="display: none;">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </button>
    </div>

    <div class="login-wrapper">
        <div class="login-container">
            <div class="login-logo">
                <h1>IASEP Farmacia</h1>
            </div>

            <div id="errorMessage" class="error-message">
                Usuario o contraseña incorrectos
            </div>

            <form id="loginForm" class="login-form">
                <input type="email" id="username" placeholder="Correo electrónico" required>
                <input type="password" id="password" placeholder="Contraseña" required>
                <button type="submit">Iniciar Sesión</button>
            </form>
        </div>
    </div>

    <footer>
        <p>aolender | <a href="https://github.com/aolender1" target="_blank">GitHub</a></p>
    </footer>

    <script>
        // Script para manejar el cambio de tema
        document.addEventListener('DOMContentLoaded', function () {
            const themeToggle = document.getElementById('themeToggle');

            // Función para alternar el tema
            function toggleTheme() {
                const body = document.body;
                body.classList.toggle('dark-theme');

                // Guardar la preferencia del usuario
                const isDarkTheme = body.classList.contains('dark-theme');
                localStorage.setItem('darkTheme', isDarkTheme);

                // Toggle icons visibility
                const moonIcon = themeToggle.querySelector('.moon-icon');
                const sunIcon = themeToggle.querySelector('.sun-icon');
                if (moonIcon && sunIcon) {
                    moonIcon.style.display = isDarkTheme ? 'none' : 'block';
                    sunIcon.style.display = isDarkTheme ? 'block' : 'none';
                }
            }

            // Aplicar el tema guardado cuando la página carga
            const isDarkTheme = localStorage.getItem('darkTheme') === 'true';
            if (isDarkTheme) {
                document.body.classList.add('dark-theme');
                const moonIcon = themeToggle.querySelector('.moon-icon');
                const sunIcon = themeToggle.querySelector('.sun-icon');
                if (moonIcon && sunIcon) {
                    moonIcon.style.display = 'none';
                    sunIcon.style.display = 'block';
                }
            }

            // Event listener para el botón de tema
            themeToggle.addEventListener('click', toggleTheme);

            // Configuración de Supabase
            const SUPABASE_URL = 'https://ovhenvckpzcjzrlpkanb.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92aGVudmNrcHpjanpybHBrYW5iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2MDQwNTYsImV4cCI6MjA1NjE4MDA1Nn0.L-RLxTg2cKiLK7lOwAq64uAAD_c2hSMw3GWih2Rdsiw';
            // Corregido: Usar el objeto global de Supabase correctamente
            const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

            // Manejar el envío del formulario de login
            document.getElementById('loginForm').addEventListener('submit', async function (e) {
                e.preventDefault();

                const email = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                try {
                    // Intentar iniciar sesión con Supabase
                    const { data, error } = await supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password
                    });

                    if (error) {
                        throw error;
                    }

                    // Si la autenticación es exitosa
                    console.log('Usuario autenticado:', data);

                    // Guardar estado de login en sessionStorage
                    sessionStorage.setItem('isLoggedIn', 'true');
                    sessionStorage.setItem('user', JSON.stringify(data.user));
                    sessionStorage.setItem('userEmail', email); // Guardar el email para usarlo en index.html

                    // Redirigir a la página principal
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Error de autenticación:', error.message);
                    // Mostrar mensaje de error
                    document.getElementById('errorMessage').textContent = error.message || 'Usuario o contraseña incorrectos';
                    document.getElementById('errorMessage').style.display = 'block';
                }
            });
        });
    </script>
</body>

</html>